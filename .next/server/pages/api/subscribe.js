"use strict";(()=>{var e={};e.id=761,e.ids=[761],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1309:e=>{e.exports=import("@supabase/supabase-js")},591:(e,r,s)=>{s.a(e,async(e,t)=>{try{s.r(r),s.d(r,{config:()=>l,default:()=>d,routeModule:()=>c});var n=s(1802),a=s(7153),i=s(6249),u=s(866),o=e([u]);u=(o.then?(await o)():o)[0];let d=(0,i.l)(u,"default"),l=(0,i.l)(u,"config"),c=new n.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/subscribe",pathname:"/api/subscribe",bundlePath:"",filename:""},userland:u});t()}catch(e){t(e)}})},866:(e,r,s)=>{s.a(e,async(e,t)=>{try{s.r(r),s.d(r,{default:()=>handler});var n=s(1309),a=e([n]);n=(a.then?(await a)():a)[0];let i=process.env.SUPABASE_URL,u=process.env.SUPABASE_SERVICE_ROLE_KEY,o=i&&u?(0,n.createClient)(i,u):null;async function handler(e,r){if("POST"!==e.method)return r.status(405).send("Method Not Allowed");if(!o)return r.status(500).send("Supabase service role not configured");try{let{subscription:s,userId:t}=e.body||{};if(!s||!s.endpoint)return r.status(400).send("Missing subscription");let n={user_id:t||null,endpoint:s.endpoint,p256dh:s.keys?.p256dh||null,auth:s.keys?.auth||null},{error:a}=await o.from("push_subscriptions").upsert(n,{onConflict:"user_id,endpoint"});if(a)return console.error("Supabase upsert error",a),r.status(500).send("Failed to save subscription");return r.status(200).send("Subscribed")}catch(e){return console.error("Subscribe error",e),r.status(500).send("Internal Server Error")}}t()}catch(e){t(e)}})}};var r=require("../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),s=r.X(0,[222],()=>__webpack_exec__(591));module.exports=s})();